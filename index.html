<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>▌│█║▌║▌║</title>

<style>
    body {
        margin: 0;
        width: 100vw;
        height: 100vh;
        background: #000;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        color: white;
        overflow: hidden;
    }

    canvas {
        position: fixed;
        inset: 0;
        z-index: 0;
        image-rendering: pixelated;
    }

    #center {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        max-width: 80%;
        z-index: 10;
        pointer-events: none;
    }

    #center p {
        font-size: 1.5rem;
        line-height: 1.6;
        margin: 0;
    }

    .fragment {
        position: absolute;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        font-size: 0.85rem;
        color: #ffffff;
        max-width: 320px;
        line-height: 1.4;
        white-space: pre-wrap;
        z-index: 10;
    }
</style>
</head>

<body>

<canvas id="bg"></canvas>

<div id="center">
<p>ιт'ѕ яєтυяηιηg...</p>
</div>

<script>
/* ===== DEVICE-AWARE GLITCH BACKGROUND ===== */
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d", { alpha: false });

let W, H, dpr;

/* ---- DEVICE DETECTION ---- */
const isMobile = matchMedia(
  "(pointer: coarse), (max-width: 768px)"
).matches;

/* ---- TUNED VALUES ---- */
const TEAR_ALPHA = isMobile ? 0.45 : 0.22;
const TEAR_HEIGHT = isMobile ? 5 : 3;
const TEAR_FREQ = isMobile ? 0.75 : 0.55;
const TEAR_SHIFT = isMobile ? 260 : 180;

function resize() {
  dpr = Math.max(1, Math.min(2, devicePixelRatio || 1));
  W = Math.floor(innerWidth * dpr);
  H = Math.floor(innerHeight * dpr);
  canvas.width = W;
  canvas.height = H;
  ctx.imageSmoothingEnabled = false;
}
addEventListener("resize", resize);
resize();

function glitch() {
  const slices = 4 + (Math.random() * 7 | 0);

  for (let i = 0; i < slices; i++) {
    const h = (8 + Math.random() * 45) * dpr;
    const y = Math.random() * (H - h);
    const shift = (-TEAR_SHIFT/2 + Math.random() * TEAR_SHIFT) * dpr;
    ctx.drawImage(canvas, 0, y, W, h, shift, y, W, h);
  }

  /* ADAPTIVE SCREEN TEAR */
  if (Math.random() < TEAR_FREQ) {
    const y = Math.random() * H;
    ctx.fillStyle = `rgba(255,255,255,${TEAR_ALPHA})`;
    ctx.fillRect(0, y, W, TEAR_HEIGHT * dpr);
  }
}

function frame() {
  ctx.fillStyle = "rgba(0,0,0,0.1)";
  ctx.fillRect(0, 0, W, H);

  // glitch blocks (unchanged)
  if (Math.random() < 0.28) {
    const v = 190 + Math.random() * 60 | 0;
    ctx.fillStyle = `rgba(${v},${v},${v},0.12)`;
    ctx.fillRect(
      Math.random() * W,
      Math.random() * H,
      Math.random() * 260 * dpr,
      Math.random() * 60 * dpr
    );
  }

  if (Math.random() < 0.08) glitch();

  requestAnimationFrame(frame);
}

frame();

// tap/click burst
addEventListener("pointerdown", () => {
  for (let i = 0; i < 4; i++) glitch();
});
</script>

<script>
/* ===== YOUR ORIGINAL LOGIC (UNCHANGED) ===== */
const fragments = [
];

const gridCells = [
    [0,0], [0,1], [0,2],
    [1,0],         [1,2],
    [2,0], [2,1], [2,2]
];

const storageKey = "fragmentLayout";
let saved = JSON.parse(localStorage.getItem(storageKey)) || {};

const cellPadding = 8;
const cellWidth = 100 / 3;
const cellHeight = 100 / 3;

fragments.forEach((text, index) => {
    let data = saved[text];

    if (!data) {
        const cell = gridCells[index];
        if (!cell) return;

        data = {
            cell,
            offsetX: Math.random() * (cellWidth - cellPadding * 2) + cellPadding,
            offsetY: Math.random() * (cellHeight - cellPadding * 2) + cellPadding
        };

        saved[text] = data;
    }

    const x = data.cell[1] * cellWidth + data.offsetX;
    const y = data.cell[0] * cellHeight + data.offsetY;

    const el = document.createElement("div");
    el.className = "fragment";
    el.textContent = text;
    el.style.left = x + "vw";
    el.style.top = y + "vh";

    document.body.appendChild(el);
});

localStorage.setItem(storageKey, JSON.stringify(saved));
</script>

</body>
</html>
